### 2020-09-01

- 定义

  区块链本质是去中心化的数据库。

  - 狭义的区块链指一种按时间顺序将数据区块相连的一种链式数据结构，并通过密码学的方法保证不可篡改、不可伪造。
  - 广义的区块链是通过链式数据结构验证和存储数据，通过共识算法生成和更新数据，通过密码学保证数据传输和访问安全，利用智能合约来编程和操作数据的一种分布式架构。

- 区块链技术特征

  1. 链式数据结构。一个区块包含若干个交易的数据，并且通过记录上一个区块的哈希值来保证整个数据链的不可篡改。
  2. 分布式共识算法。如Paxos、Raft
  3. 密码学方式。可能涉及对称、非对称加密，哈希算法，数字签名

- 区块链分类

  1. 公有链(Public Blockchains)。所有人均可作为网络中的节点而无需授权，采用工作量证明(PoW, Proof of Work)或权益证明(PoS, Proof of Stake)等共识算法；与之对应的联盟链则需要由某些具有资质的节点对新加入节点进行授权，如hyperledger fabric由orderer节点处理交易和授权。典型应用：比特币、以太坊。
  2. 联盟链(alliance Blockchains)，也叫许可链(Permission chain?)。是一种去中心化或者部分去中心化的区块链，表现为共识过程受某些指定节点控制，共识算法通常采用PBFT、Raft等。典型应用：Hyperledger、Corda、Hyperchain。
  3. 私有链(Private Blockchains)。由一个组织完全掌握区块链的写入权限，并控制读取权限的发放。应用场景常为企业内部总公司对分公司的管理。


- 以太坊

  - 构成/概念
    1. 节点。
    2. 矿工。指不断重复哈希运算来产生工作量的网络节点。
    3. 挖矿。通过挖矿来产生以太币。(对挖矿的理解：)
    4. 账户。外部账户，由公私钥控制；合约账户则在区块链上唯一标识某个智能合约。两类账户都包含以太币余额，能发送交易。
    5. gas。交易需要矿工参与，并支付费用，称之为gas。
    6. EVM。以太坊虚拟机，是智能合约的运行环境。
    7. 智能合约。
    8. 交易。


本日疑问:

  1. 照目前的理解来看，区块链也相当于一个数据库，区块中的交易相当于数据库的增删查改等操作的日志记录，一个交易可能导致world state(hyperledger)值的变化，其过程大致可认为是对关系表的某个字段进行修改。区块链的不可篡改，也就是日志的不可篡改，而字段的值仍然可以通过新的交易来进行修改。  
  那么关于区块链的应用场景，如数字票据要求的安全性，是否就是交易过程的不可篡改？
  
  2. 能用**以太坊做什么**？


本日待做:

  1. 了解PoW、PoS、PBFT等机制，Hashcash工作量证明算法
  2. 椭圆曲线加密算法(ECC, Elliptic Curve Cryptography) & 椭圆曲线数字签名算法(ECDSA, Elliptic Curve Digital Signature Algorithm)
  3. SHA256 & Merkle Tree


### 2020-09-02

本日完成：
  
  1. SHA256伪代码理解，博文未完成 #09-03补：伪代码摘录，未实现


### 2020-09-03

  - 工作量证明

    思想是需要客户端完成一定工作量的运算，才能满足系统的要求完成操作，从而限制TPS。  
    超简化的例子：给定一个字符串"Hello world"，工作量要求为在字符串后添加一个整数，称为nounce，然后对整个字符串进行 SHA256 哈希运算，要得到以"0000"开头的哈希摘要。要找到这样的字符串只能通过暴力搜索，遍历所有nounce、计算哈希直到找到满足要求的nounce值为止。
    略详细的解释见[**此处**](https://www.infoq.cn/article/bitcoin-and-block-chain-part02)

  - 本日疑问：
  1. 比特币如何通过PoW解决拜占庭问题？工作量证明应当只是降低了产生交易的速率（通过将交易速率降低当某一时刻只有一个节点发出广播，在不考虑作恶节点的情况下，其他所有节点只要对收到的交易请求无条件认可即可），那么对于拜占庭将军问题中提到的作恶节点问题，如何解决？另外，能够确保某一时刻一定只存在一笔交易广播吗，如果有两笔交易同时广播了，会出现什么问题？


### 2020-09-04

  - PBFT, Practical Byzantine Fault Tolerance
    1. 3f + 1个节点可容忍 f 个错误节点(faulty)  
    设共有N个节点，假设最坏情况，存在f个故障节点，并且另有 f 个错误节点，此时客户端可收到的 N-f 条消息中含 N-2f 条正确节点发送的消息。要保证一致性，则需要正确消息的数量永远多于错误的消息(因为故障节点消息被认为是丢失了)，因此 N-2f>f，N 至少需要是 3f+1。

  

  - 椭圆曲线数字签名算法(ECDSA, Elliptic Curve Digital Sinature Algorithm)



### 2020-09-13

  无

### 2020-09-16

  > **本日目标：Fabric处理数据、存储和保护隐私，Fabric的数据管理**  

  - 成员服务：成员注册、身份保护、内容保护、交易审计
    
    - PKI, Public Key Infrastructure

      Fabric 当前采用CA签发证书的方式。PKI需要包含证书颁发机构 CA，注册机构 RA，证书数据库和证书存储实体

          Root Certificate Authority
          |             |           |
          Enrollment Transaction   TLS-CA
              CA          CA
      
      ECA: 验证凭证后发布注册证书 ECerts
      TCerts：验证凭证后发出交易证书
      TLS-CA：颁发TLS证书和凭据 TLS-Certs，用于系统组件之间通信，保证网络安全性
      

  - 区块链服务：节点共识、账本分布式计算、账本存储

    1. 共识管理：Fabric中Orderer节点负责提供共识服务，\[保证消息通信的序列化和可靠性\]? Kafka(基于zookeeper，可容忍宕机节点但不能容忍恶意节点), Raft

    2. 分布式账本：账本约等于数据库，分布式账本也就是一种分布式数据库，存储着交易和状态变更的记录。Fabric中节点通过加入channel来获得该channel对应账本的查看和修改权限，同时每个加入的peer可以维护一份账本的备份（由orderer负责通知账本状态的变更，也就是每个交易orderers达成共识并且更新账本之后，会向peer发送执行交易操作的请求？（待验证））  
 
    3. 账本存储：账本由两部分组成，Chain部分记录着交易的历史记录；State部分对应交易中所有变量的最新值
    
    4. P2P网络：Fabric网络包含三类节点：Client，Peer，Orderer  
    Orderer节点组成共识服务，通过共识算法保证交易的顺序，然后将达成共识的交易广播给Peer。  
    Peer节点备份账本，通过与共识节点通信维护 World State；同时可以成为背书节点 Endorsement(待验证)
    Client创建交易，通过与Peer通信来接入Fabric网络

  - 链码服务：智能合约的执行引擎

  

  本日疑问：

  0. 这本书写的跟我想象中的也不太一样，对于Fabric的描述，比如交易过程的描述，只是非常粗略的讲解，比如说，描述了验证客户端签名是否正确然后模拟执行，生成返回值和交易结果，然后对该提案进行背书操作，附上anchor信息返回给客户端。P135  
  背书操作没有描述，anchor信息没有介绍，为什么要返回给客户端也没有介绍，  
  看完之后对于背书操作是什么还是没有了解。



  1. Enrollment Certification的作用？仅描述一句长期证书，对所有角色颁发，是否指拥有ECerts的才认为是成员？

  2. 共识服务，共识算法要解决的问题；它们所解决问题的方案；  

  Raft可以使分布式集群在若干个节点同时收到若干请求时，能够使整个集群中的replica保持一致的状态（哪怕出现了leader的宕机或少于一半节点的宕机）

  3. 有个问题，目前的区块链对于长时间运转后，得到的包含大量交易记录的链，如何处理？是否是把一定时间或者超过一定长度的部分截断删除？

  4. **Fabric背书是什么作用**，背书策略的意义是什么，选用不同背书策略应该基于什么考量？

  5. Fabric的开发模式？是Solo？

  6. 锚节点是什么？作用？
  描述：能被所有对等节点探测并与之通信的节点？
  什么玩意？

  本日待做：
  1. Merkle Tree 的结构


### 2020-09-18

> 原话：建议先从联盟链Fabric处理哪些数据，又是如何存储及隐私保护方面切入  
> **本日目标：从Fabric文档中找到上述问题的答案**  


本日笔记：
  
  - 比特币和以太坊因为每个参与维护的核心节点都要保存完成存储和进行智能合约的处理，此时整个网络的总存储和计算能力受制于单个节点的能力。公有网络中大量低性能节点会降低整个系统的性能。

  - 联盟链中可以通过使用高性能的核心节点一定程度解决这一问题。

  - 区块链虽然类似数据库可以存储和管理数据，但是面向的核心问题还是多方数据互信写作（Data Collaboration），并且目前从数据存储和管理的角度上，区块链的效率不如数据库。

  Fabric 组件
  - ordering service
  - membership service
  - peer-to-peer gossip service(optional)
  - smart contracts/ chaincode
  - endorsement and validation policy enforcement


本日疑问：

1. 如何提高区块链系统的交易性能使其能够支撑一些大规模交易系统的运行？目前区块链的TPS由于要保证安全性，如运行共识算法和加密算法等（待完善），导致TPS无法达到数万TPS，那么应当从什么方向提升？

另，目前的交易系统是如何运行的？通过什么方式来保证安全性？

2. 不同账本的跨链互通机制

  - 公证人机制（Notary）  
  - 侧链/中继链锚定（Sidechains/Relays）
  - 哈希锁定（Hash-Locking）

3. Token 令牌，应用过程和作用

4. 为什么能降低交易成本？
> 金融服务：区块链带来的潜在优势包括降低交易成本、减少跨组织交易风险等。该领域的区块链应用目前最受关注，全球不少银行和金融交易机构都是主力推动者。部分投资机构也在应用区块链技术降低管理成本和管控风险。

5. 跨链技术[Polkado](https://www.hyperchain.cn/news/274.html)、Cosmos

6. Fabric 文档中提到，Fabric网络中的节点虽然不是匿名的，但是，有可能相互之间并不信任，举的例子是现实情况中同一行业中不同的公司企业。 6


