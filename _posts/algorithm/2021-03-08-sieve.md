---
layout: post
title: "Sieve of Eratosthenes"
subtitle: 
author: "Dongbo"
header-style: text
mathjax: true
hidden: true
tags:
  - algorithm
---

又碰到求整数 2~N 之间质数个数的质数筛问题，大致看了几个博客，感觉[\[1\]](https://www.cnblogs.com/grubbyskyer/p/3852421.html)没有提及埃氏筛在遍历过程中可进行的优化, [\[2\]](https://zhuanlan.zhihu.com/p/100051075)没有解释为什么在验到 $N$ 的平方根时可以终止。
                                                                                                     
每个数都使用判别质数的方法进行判断的话，复杂度比较高，很容易被卡掉，因此以下主要介绍两种常用的质数筛法。

[参考 OJ wiki]

### 埃氏筛

埃氏筛基本思想可以总结为：

1. 遍历 $[2, sqrt(N)]$ ，每碰到一个质数 $P$，就把 $[2, N]$ 内所有 $P$ 的倍数标记为合数
2. 当遍历到某个未被标记为质数的数时，可以把它当作质数，然后重复步骤1

步骤1中,遍历到$sqrt(N)$ 而非到 $N$ 就能够筛完 $[2, N]$ 中所有合数的理由是，如果 $N$ 存在一个因数 $ n_1>sqrt(N) $，那么必然有对应的因数 $ n_2\<sqrt(N) $，而步骤1能保证通过因数 $n_2$ 将合数 $N$ 标为合数。此时所有比 $N$ 小的合数，因为它们必然存在小于 $sqrt(N)$ 的因数，所以在遍历至 $sqrt(N)$ 时已经被标记过；最极端的情况为 $sqrt(N)$ 是 $N$ 唯一的质因数，因此需要筛到 $ sqrt(N) $，这样能保证所有小于等于 $N$ 的合数都被标记过。

步骤2的理由是，如果一个数没有被比它小的数筛选过，即它不存在1和自己以外的因数，所以它是质数。

另外步骤1有个小的优化，在进行合数标记时，不用从质数的2倍开始，可以直接从质数的平方开始。理由是，若当前遍历到$i$，则小于 $ i \times i $ 的合数已经被小于 $[2, i-1]$ 中的某个质数筛过了。比如当前遍历到7，那么不需要将 $14=2 \times 7, 21=3 \times 7,..., 42=6 \times 7$再标记为合数，因为14已经在遍历到2、21在遍历到3、28在遍历到2、35在遍历到5...时都已经进行了标记，因此我们可以省略掉这部分重复标记的工作，直接从 $49=7 \times 7$开始。

但是哪怕做了以上的优化，依然存在重复筛选的现象，如以下经过优化的埃氏筛代码，24依然会被2，3，4筛选，36会被2，3，4，6筛选。

//code

因此接下来介绍能够解决上述问题的欧拉筛

### 欧拉筛

首先由 [算术基本定理](1) 知，每个合数可以写为若干个质数乘积的形式，分解得到的形式唯一。

欧拉筛的思想为：令每个质数只被它的最小质因数标记。因为最小质因数只有一个，所以每个合数只会被标记一次。不过这样就不能像埃氏筛的代码那样，筛选完合数之后再统计质数个数，需要维护一个质数表，遇到新的质数时将其加入表中。
 
每次

令i属于[2, N]， P属于【当前质数】，将i*P标记为合数，

这里有个不太好理解的小地方是，------行，


简要的筛选过程【】 与埃氏筛对比【】
可以看到这种方法筛掉合数的步骤与埃氏筛略有不同，

[1]: https://zh.wikipedia.org/wiki/%E7%AE%97%E6%9C%AF%E5%9F%BA%E6%9C%AC%E5%AE%9A%E7%90%86